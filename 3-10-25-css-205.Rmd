---
title: "final_205_3-10-25"
author: "Belynda Herrera"
date: "2025-03-10"
output: pdf_document
---

```{r}
knitr::opts_chunk$set(echo = TRUE)
```

Loads the dataset and libraries

```{r}
library(readr)
library(tidyverse) 
library(MASS)       
library(pscl)       
library(caret)
library(ggplot2) 

data <- read_csv("~/Downloads/CSS205_Final_Cleaned_Data.csv")
```

checks for missing values.

```{r}
summary(data)
sapply(data, function(x) sum(is.na(x)))  # Count missing values per column

```

Handle Missing Data

```{r}
# Impute missing income with median
data$hincome[is.na(data$hincome)] <- median(data$hincome, na.rm = TRUE)

# Impute missing living partner status with mode
mode_value <- as.numeric(names(sort(table(data$livingpartner), decreasing = TRUE)[1]))
data$livingpartner[is.na(data$livingpartner)] <- mode_value

# Verify that missing values are handled
sapply(data, function(x) sum(is.na(x)))

```

```{r}
# Define Model Variables
selected_vars <- c("vim_vox", "sex", "age", "education", "hincome", "livingpartner", 
                   "femindexa", "femindexb", "femindexc", "femindexd", "femindexe", 
                   "authoritarian", "nativism", "lrself", "populisma", "orgterr")
data_model <- data[selected_vars]
```
Fit the Original Logistic Regression Model
```{r}
original_model <- glm(vim_vox ~ sex + age + education + hincome + livingpartner + 
                      femindexa + femindexb + femindexc + femindexd + femindexe +
                      authoritarian + nativism + lrself + populisma + orgterr, 
                      family = binomial(link = "logit"), data = data_model)

```




Fitting the New Model
```{r}
new_model <- glm(vim_vox ~ age + femindexa + femindexb + nativism + lrself + orgterr, 
                 family = binomial(link = "logit"), data = data_model)

```

Model Comparison Using AIC & BIC

```{r}
AIC(original_model)
BIC(original_model)
AIC(new_model)
BIC(new_model)

```

In-Sample Model Performance (Confusion Matrix)

```{r}
pred_original <- ifelse(predict(original_model, type = "response") > 0.5, 1, 0)
pred_new <- ifelse(predict(new_model, type = "response") > 0.5, 1, 0)



confusionMatrix(factor(pred_original), factor(data_model$vim_vox))
confusionMatrix(factor(pred_new), factor(data_model$vim_vox))
```

Out-of-Sample Validation (10-Fold Cross-Validation)

```{r}
k_fold <- trainControl(method = "cv", number = 10)
cross_val_original <- train(vim_vox ~ sex + age + education + hincome + livingpartner + 
                             femindexa + femindexb + femindexc + femindexd + femindexe +
                             authoritarian + nativism + lrself + populisma + orgterr, 
                             data = data_model, method = "glm", trControl = k_fold, family = binomial)

cross_val_new <- train(vim_vox ~ age + femindexa + femindexb + nativism + lrself + orgterr, 
                       data = data_model, method = "glm", trControl = k_fold, family = binomial)

```

Compare Cross-Validation Results
```{r}
cross_val_original$results
cross_val_new$results

```

Selecting the Best Model Based on AIC & BIC

```{r}
if (AIC(new_model) < AIC(original_model) & BIC(new_model) < BIC(original_model)) {
  selected_model <- new_model
} else {
  selected_model <- original_model
}


```

Plotting Predicted Probabilities

```{r}
predicted_probs <- data.frame(vim_vox = data_model$vim_vox, pred = predict(selected_model, type = "response"))

ggplot(predicted_probs, aes(x = pred, fill = as.factor(vim_vox))) +
  geom_histogram(position = "identity", alpha = 0.6, bins = 30) +
  labs(title = "Predicted Probabilities of Voting for Vox",
       x = "Predicted Probability", y = "Count") +
  theme_minimal()

```
